<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impressão - Solicitação de Contratação</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            .no-print { display: none !important; }
            body { background: #fff; }
            .sheet { box-shadow: none !important; border: 0 !important; }
        }
        body { background: #f2f2f2; }
        .sheet { max-width: 980px; margin: 24px auto; background: #fff; padding: 32px; box-shadow: 0 14px 36px rgba(0,0,0,.12); border-radius: 12px; }
        .title { font-weight: 700; }
        .muted { color: #6c757d; }
        .label { font-weight: 600; }
        .sig-line { border-top: 1px solid #1f2937; height: 2px; margin-top: 56px; }
        .brand { display:flex; gap:12px; align-items:center; }
        .brand .logo { width:48px; height:48px; border-radius:10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .badge-soft { display:inline-block; padding: .25rem .6rem; border-radius: 999px; font-size: .8rem; font-weight:600; }
        .badge-open { background: rgba(13, 110, 253,.12); color:#0d6efd; }
        .badge-closed { background: rgba(25, 135, 84,.12); color:#198754; }
        hr { border-top: 1px dashed #e5e7eb; }
        .field { padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fafafa; }
    </style>
</head>
<body>
    <div class="sheet">
        <div class="d-flex justify-content-between align-items-start">
            <div class="brand">
                <div class="logo"></div>
                <div>
                    <div class="h4 title mb-0">Solicitação de Contratação</div>
                    <div class="muted" id="req-id"></div>
                </div>
            </div>
            <div class="no-print">
                <button class="btn btn-primary" onclick="window.print()"><i class="fas fa-print"></i> Imprimir</button>
            </div>
        </div>
        <hr>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="label">Empresa</div>
                <div id="campo-empresa" class="field">-</div>
            </div>
            <div class="col-md-6">
                <div class="label">Setor</div>
                <div id="campo-setor" class="field">-</div>
            </div>
            <div class="col-md-6">
                <div class="label">Cargo</div>
                <div id="campo-cargo" class="field">-</div>
            </div>
            <div class="col-md-6">
                <div class="label">Status</div>
                <div id="campo-status" class="field">-</div>
            </div>
            <div class="col-md-6">
                <div class="label">Aberta em</div>
                <div id="campo-abertaEm" class="field">-</div>
            </div>
            <div class="col-md-6">
                <div class="label">Solicitante (UID)</div>
                <div id="campo-solicitante" class="field">-</div>
            </div>
            <div class="col-12">
                <div class="label">Observações</div>
                <div id="campo-observacoes" class="field" style="min-height:80px;">-</div>
            </div>
        </div>

        <div class="row mt-5 g-5">
            <div class="col-md-6 text-center">
                <div class="sig-line"></div>
                <div>Responsável pelo Setor</div>
            </div>
            <div class="col-md-6 text-center">
                <div class="sig-line"></div>
                <div>Diretoria / Autorização</div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script>
        function getParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }

        function formatarData(d) {
            try { return d.toLocaleDateString('pt-BR') + ' ' + d.toLocaleTimeString('pt-BR'); } catch { return '-'; }
        }

        async function carregar() {
            const id = getParam('id');
            if (!id) { alert('ID não informado'); return; }
            document.getElementById('req-id').textContent = `ID: ${id}`;
            const doc = await db.collection('contratacoes').doc(id).get();
            if (!doc.exists) { alert('Solicitação não encontrada'); return; }
            const data = doc.data();

            document.getElementById('campo-setor').textContent = data.setor || '-';
            document.getElementById('campo-cargo').textContent = data.cargo || '-';
            // badge de status
            const status = (data.status || '-').toString().toLowerCase();
            const statusEl = document.getElementById('campo-status');
            const cls = status === 'pendente' ? 'badge-soft badge-open' : 'badge-soft badge-closed';
            statusEl.innerHTML = `<span class="${cls}">${data.status || '-'}</span>`;
            document.getElementById('campo-abertaEm').textContent = data.abertaEm?.toDate ? formatarData(data.abertaEm.toDate()) : '-';
            document.getElementById('campo-solicitante').textContent = data.createdByUid || '-';
            document.getElementById('campo-observacoes').textContent = data.observacoes || '-';

            // Carregar nome da empresa
            let nomeEmpresa = '-';
            if (data.empresaId) {
                try {
                    const emp = await db.collection('empresas').doc(data.empresaId).get();
                    nomeEmpresa = emp.exists ? (emp.data().nome || '-') : '-';
                } catch {}
            }
            document.getElementById('campo-empresa').textContent = nomeEmpresa;
        }

        document.addEventListener('DOMContentLoaded', carregar);
    </script>
</body>
</html>
