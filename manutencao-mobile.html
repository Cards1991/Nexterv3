
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abrir Chamado de Manutenção</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- Configuração do Firebase -->
    <script src="js/env-loader.js"></script>

    <style>
        body {
            background-color: #f4f7f6;
        }
        .container {
            max-width: 600px;
        }
        .card-header {
            background-color: #0d6efd;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-tools"></i> Abrir Chamado de Manutenção</h4>
            </div>
            <div class="card-body">
                <div id="loading-spinner" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-3">Inicializando...</p>
                </div>

                <!-- Tela de Login (Injetada) -->
                <div id="login-container" class="d-none">
                    <div class="text-center mb-4">
                        <h5 class="text-primary"><i class="fas fa-lock"></i> Acesso Restrito</h5>
                        <p class="text-muted small">Faça login para abrir um chamado.</p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">E-mail</label>
                        <input type="email" id="mobile-login-email" class="form-control" placeholder="seu@email.com">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Senha</label>
                        <input type="password" id="mobile-login-password" class="form-control" placeholder="******">
                    </div>
                    <div class="d-grid">
                        <button class="btn btn-primary" onclick="fazerLoginMobile()">Entrar</button>
                    </div>
                    <div id="login-error" class="text-danger mt-3 text-center small"></div>
                </div>

                <script>
                    document.addEventListener('DOMContentLoaded', () => {
                        if (typeof firebase !== 'undefined' && !firebase.apps.length && window.__FIREBASE_CONFIG__) {
                            firebase.initializeApp(window.__FIREBASE_CONFIG__);
                            window.db = firebase.firestore();
                            window.auth = firebase.auth();
                        }

                        firebase.auth().onAuthStateChanged(user => {
                            if (!user) {
                                document.getElementById('loading-spinner').classList.add('d-none');
                                document.getElementById('form-container').classList.add('d-none');
                                document.getElementById('login-container').classList.remove('d-none');
                            } else {
                                document.getElementById('login-container').classList.add('d-none');
                                document.getElementById('loading-spinner').classList.add('d-none');
                                document.getElementById('form-container').classList.remove('d-none');
                            }
                        });
                    });

                    function fazerLoginMobile() {
                        const email = document.getElementById('mobile-login-email').value;
                        const pass = document.getElementById('mobile-login-password').value;
                        const errorDiv = document.getElementById('login-error');
                        if(!email || !pass) { errorDiv.textContent = "Preencha todos os campos."; return; }
                        errorDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Autenticando...';
                        firebase.auth().signInWithEmailAndPassword(email, pass).catch(error => { errorDiv.textContent = "Erro: " + error.message; });
                    }
                </script>

                <div id="form-container" class="d-none">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Máquina</label>
                        <input type="text" class="form-control form-control-lg" id="mobile-maquina-id" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="mobile-motivo" class="form-label fw-bold">Motivo da Parada / Problema</label>
                        <textarea class="form-control" id="mobile-motivo" rows="4" placeholder="Descreva o problema observado..." required></textarea>
                    </div>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="mobile-maquina-parada">
                        <label class="form-check-label" for="mobile-maquina-parada">A máquina está parada?</label>
                    </div>
                    <div class="d-grid">
                        <button class="btn btn-primary btn-lg" id="btn-salvar-chamado-mobile">
                            <i class="fas fa-save"></i> Abrir Chamado
                        </button>
                    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
                </div>
                <div id="success-message" class="text-center d-none">
                    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                    <h3>Chamado Aberto com Sucesso!</h3>
                    <p>A equipe de manutenção já foi notificada.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="js/manutencao-mobile.js?v=1.6"></script>
</body>
</html>
